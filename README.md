# Bot-stats - Telegram Bot –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º

Telegram –±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–π –≤ BigQuery –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ Selenium.

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–æ–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–π –≤ BigQuery
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ Selenium –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "tsum cs"
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–æ–≤ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –±–µ—Å–µ–¥—ã Telegram
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
- ‚úÖ –ó–∞—â–∏—Ç–∞ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º —Å –±—ã—Å—Ç—Ä—ã–º –ø–µ—Ä–µ—Ö–æ–¥–æ–º

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- Telegram Bot Token
- –î–æ—Å—Ç—É–ø –∫ BigQuery
- –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ú–æ–∑–∞–∏–∫—É

## üê≥ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Docker)

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository_url>
cd Bot-stats
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# Telegram Bot Token
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞

# BigQuery –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
BIGQUERY_PROJECT_ID=–≤–∞—à_project_id
GOOGLE_APPLICATION_CREDENTIALS={"type":"service_account","project_id":"...","private_key_id":"...","private_key":"-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n","client_email":"...","client_id":"...","auth_uri":"...","token_uri":"...","auth_provider_x509_cert_url":"...","client_x509_cert_url":"..."}

# Mosaica —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ú–æ–∑–∞–∏–∫—É)
EMAIL=sb@dresscode.ai
PASSWORD_M=–≤–∞—à_–ø–∞—Ä–æ–ª—å

# BigQuery —Ç–∞–±–ª–∏—Ü–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
BIGQUERY_TABLE_COLLECTIONS=–≤–∞—à_–ø—Ä–æ–µ–∫—Ç.–≤–∞—à_–¥–∞—Ç–∞—Å–µ—Ç.–≤–∞—à–∞_—Ç–∞–±–ª–∏—Ü–∞
```

**–í–∞–∂–Ω–æ:** 
- `GOOGLE_APPLICATION_CREDENTIALS` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ —Å—Ç—Ä–æ–∫ (`\n`)
- –ï—Å–ª–∏ –≤ –ø–∞—Ä–æ–ª–µ –µ—Å—Ç—å —Å–∏–º–≤–æ–ª `$`, –µ–≥–æ –Ω—É–∂–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ `$$` –∏–ª–∏ –æ–±–µ—Ä–Ω—É—Ç—å –≤ –∫–∞–≤—ã—á–∫–∏

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É `data/` –∏ —Ñ–∞–π–ª `data/users.json`:

```json
{
  "users": [
    {
      "telegram_id": 123456789,
      "username": "username",
      "status": "manager"
    }
  ]
}
```

**–í–∞–∂–Ω–æ:** –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `"manager"` –º–æ–≥—É—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º.

### 4. –ó–∞–ø—É—Å–∫

```bash
docker-compose up -d --build
```

### 5. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
docker-compose logs -f bot
```

## üì± –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
- `/collections` - –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `/collections_tsum` - –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "tsum cs"
- `/status <collection_id>` - –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –§–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö

–í—Å–µ —Ñ–∞–π–ª—ã –≤ `data/` —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –º–æ–∂–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∑–∞—Ä–∞–Ω–µ–µ:

- `data/users.json` - —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `data/chats.json` - —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ (–∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `data/collections_status.json` - –∫—ç—à —Å—Ç–∞—Ç—É—Å–æ–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–π (—Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `data/google_cookies.json` - cookies –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ú–æ–∑–∞–∏–∫—É (—Å–æ–∑–¥–∞—Å—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–æ–≤

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —á–∞—Ç—ã –≤ `data/chats.json` –ø—Ä–∏:
- –î–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É/—Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—É
- –ü–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –≤ –≥—Ä—É–ø–ø–µ

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Bot-stats/
‚îú‚îÄ‚îÄ config/              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ settings.py
‚îú‚îÄ‚îÄ services/            # –°–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ bq_client.py          # –†–∞–±–æ—Ç–∞ —Å BigQuery
‚îÇ   ‚îú‚îÄ‚îÄ selenium_collector.py # –°–±–æ—Ä –æ—Ç—á–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ Selenium
‚îÇ   ‚îú‚îÄ‚îÄ status_tracker.py     # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ report_sender.py      # –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ scheduler.py          # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
‚îÇ   ‚îî‚îÄ‚îÄ chat_manager.py      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏
‚îú‚îÄ‚îÄ handlers/            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îú‚îÄ‚îÄ commands.py
‚îÇ   ‚îî‚îÄ‚îÄ report_handler.py
‚îú‚îÄ‚îÄ data/                # –î–∞–Ω–Ω—ã–µ (–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ volume)
‚îÇ   ‚îú‚îÄ‚îÄ users.json
‚îÇ   ‚îú‚îÄ‚îÄ chats.json
‚îÇ   ‚îî‚îÄ‚îÄ collections_status.json
‚îú‚îÄ‚îÄ bot.py               # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ requirements.txt
```

## üö¢ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –ß—Ç–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å DevOps:

1. **–§–∞–π–ª `.env`** - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. **–ü–∞–ø–∫–∞ `data/`** —Å —Ñ–∞–π–ª–æ–º `data/users.json` - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è DevOps:

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository_url>
cd Bot-stats

# 2. –ü–æ–ª–æ–∂–∏—Ç—å .env –∏ data/ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose up -d --build

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f bot
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞:

```bash
cd Bot-stats
git pull
docker-compose down
docker-compose up -d --build
```

## ‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –∫–æ–ª–ª–µ–∫—Ü–∏–π –∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `config/settings.py`)
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "tsum cs" —Å–æ–±–∏—Ä–∞–µ—Ç –æ—Ç—á–µ—Ç —á–µ—Ä–µ–∑ Selenium
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á–µ—Ç—ã –≤ —á–∞—Ç—ã –∏–∑ `data/chats.json`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —á–∞—Ç—ã –≤ `data/chats.json` –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ git:**
- `.env` —Ñ–∞–π–ª
- `data/users.json` (—Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- `data/google_cookies.json` (—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- `data/collections_status.json` (–∫—ç—à)

**–ú–æ–∂–Ω–æ –∫–æ–º–º–∏—Ç–∏—Ç—å:**
- `data/chats.json.example` (–ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
- `data/users.json.example` (–ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)

## üìù –õ–æ–≥–∏

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `logs/bot.log` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:

```bash
docker-compose logs -f bot
```

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "Text must be non-empty"
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç (—Ö–æ—Ç—è –±—ã "–°—Ç—Ä–∞–Ω–∏—Ü–∞ X/Y").

### –û—à–∏–±–∫–∞ "Failed to login to admin panel"
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `EMAIL` –∏ `PASSWORD_M` –≤ `.env` —Ñ–∞–π–ª–µ.

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ:
1. –í–∞—à `telegram_id` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `data/users.json`
2. –í–∞—à —Å—Ç–∞—Ç—É—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ `"manager"`

### Cookies –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –≤–æ–π—Ç–∏ –≤ –ú–æ–∑–∞–∏–∫—É –≤—Ä—É—á–Ω—É—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è cookies.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
